version: 3.1.0

pipeline:
  name: pyannote.audio.pipelines.SpeakerDiarization
  params:
    clustering: AgglomerativeClustering
    embedding: pyannote/wespeaker-voxceleb-resnet34-LM
    embedding_batch_size: 32
    embedding_exclude_overlap: true
    segmentation: pyannote/segmentation-3.0
    segmentation_batch_size: 32

params:
  clustering:
    method: centroid

    ## min_cluster_size - larger menas robustness (should detect more segs to be identifed as a clister.)
    ## threshold - less means more speakers (larger menas robustness. not identifying)
    #0.5sec * min_cluster_size needed for identifiable speach.
    # min_cluster_size: 12
    min_cluster_size: 16
    # threshold: 0.7045654963945799
    # min_cluster_size: 5     # 최소 5개 세그먼트 이상이어야 클러스터로 인정
    # min_cluster_size: 9     # 최소 5개 세그먼트 이상이어야 클러스터로 인정
    # threshold: 0.65
    threshold: 0.7
  segmentation:
    min_duration_off: 0.0

# - **단위(Unit)**: min_cluster_size는 클러스터에 포함되어야 할 **임베딩(embedding) 개수(윈도우/청크 수)**를 뜻합니다 .
# - **윈도우 설정**: 기본 파이프라인은 **5초 길이**의 윈도우(window)를 **0.5초(step) 간격**으로 겹쳐 슬라이딩하면서 각 활성 화자당 임베딩을 추출합니다 .
# - **시간 해석**: 윈도우 스텝 0.5초 × min_cluster_size 만큼의 발화가 누적되어야 클러스터로 인정됩니다. 예컨대 min_cluster_size=12면 약 **6초**(12 × 0.5 s)의 발화량에 해당합니다 .
# - **기본값**: Hugging Face의 pyannote/speaker-diarization-3.1 기본 min_cluster_size는 **12**로 설정되어 있습니다 .
# - **역할**: min_cluster_size 보다 작은 클러스터(임베딩 개수)가 생성되면, 해당 소규모 클러스터의 모든 임베딩은 가장 유사한 대형 클러스터에 병합됩니다 .
# 1. GitHub issue on pipeline hyperparameters, including clustering.min_cluster_size
# 2. HNiderb blog “How I won 2022 diarization challenges” detailing default of 15
# 3. Colab tutorial snippet recommending 15 as a good default
# 4. Hugging Face repo commit showing default of 12 in version 3.1
# 5. Hugging Face discussion on segmentation vs clustering hyperparameters
# 6. KTH PhD PDF noting min_cluster_size is not optimized and default values